# Bestdoctor_test_task

Тестовая задача на стажировку. Автор - Котельникова Ольга.

# How use
В solution.py находится код для обработки датасета. 
Запустив его, получите все промежуточные результаты, 
которые были использованы для решения,
и файл с выходными данными - ответ на задачу.

# Описание хода решения
1.Проверим, совпадает ли сумма по всем чекам из реестров с общей суммой по всем месяцам из отчета.
Результат - совпадает. => в реестре нет лишних чеков

2.Вычислим сумму чеков за каждый месяц.
Результат - суммы чеков по месяцам январь-июнь меньше, чем суммы в отчете. 
При этом дельта между суммами в отчете и суммами по реестру не очень большая 
=> можно предположить, что большинство чеков сохранено с правильными месяцами.

Так же в реестре присутствуют чеки с месяцами:

 - за более поздний период (например, 12 месяц)
 Можно было бы предположить, что такие чеки не учитываются в общей сумме и попали в реестр по ошибке,
 но в первом пункте мы проверили, что учитывать их нужно. 
 Нужно придумать, как исправить ошибку в номере месяца в таких чеках. 
 Возможные варианты - предположим, что номер месяца и число месяца перепутаны, 
 поэтому для исправления достаточно поменять их местами. 
 

 - с некорректными номерами (например, 29 месяц)
 Отлично, мы нашли еще часть ошибочных чеков. Возможный вариант исправления -  аналогично предыдущему случаю.

Исходя из результатов, ясно, что нужно исправить ошибочные чеки - понять, к какому месяцу каждый из них относится.

3.Обратим внимание на закономерности данных : 
id пациентов упрядочены по возрастанию и представляют собой порядковые номера 
=> тогда и чеки упорядчены по возрастанию, а именно, по дате.
Проверим эту гипотезу: посмотрим моду по месяцам в начале списка по первым 30 пациентам и по последним 30.
Результат - 1 месяц и 6 месяц.
Этот результат частично подверждает гипотезу.
Выведем упорядоченный список всех месяцов чеков и "глазами" отметим, что действительно месяцы идут по порядку, 
и лишь к некоторых случаях встречаются выбросы - те самые ошибки, которые мы исправляем.
Даных не так много, поэтому список уместился на нескольких строках вывода. 
При большем количестве можно было проверить это с помощью кода -  вычисленить моду  по отрезкам, предположив, 
что поток пациентов по месяцам равномерный и, сответственно, разбив этот поток на равные отрезки.

4.Чеки упорядочены по дате => найдем границы отрезков, где заканчивается очередной месяц и начинается новый.
Данных не так много, воспользуемся алгоритмом "в лоб":
  - считаем сумму по всем чекам до тех пор, пока она
    не станет равна сумме за следующий месяц (с некоторой погрешностью);
  - когда равенство случилось, мы нашли границу между текущим и следующим месяцем;
  - cумму обнуляем, повторяем алгоритм дальше, пока не переберем все данные.

*Как оптмизировать алгоритм:
считать cумму от границы сразу для 20-40 слагаемых, не делая для них проверки if, затем проверять каждый шаг на совпадение сумм.
вычислять месяц с помощью моды по ближайшим чекам - выбрать размер окна и пройтись им по данным (месяцам).

Результат - алгоритм сработал, границы найдены.
Могло так не повезти, тогда нужно было бы искать иные пути решения.
Проблема0: точное сравнение сумм в отчете и сумм по реестру - необходимо сравнивать с погрешностью.
Проблема1: tсли бы алгоритм не сработал, то гипотеза про упорядоченность чеков была бы не верной. 
Возможные путь решения - предположить, что чеки с корректными номерами месяцев безошибочны, 
исправлять только месяца >6 путем подбора слагаемых для каждого месяца так, чтобы сумма по каждому месяцу совпадала с суммой в отчете.
Алгоритм долгий и неэффективный. На больших данных нужен другой подход. В нашем случае сработал бы, т.к. ошибочных записей немного.
